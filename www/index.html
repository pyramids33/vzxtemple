<html>
<head>
<title>vzxtemple</title>
<style>
.container { 
    display: flex;
    flex-direction: column;
    width: 768px;
}
</style>
<script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"></script>
</head>
<body>
<h1>VZXTEMPLE</h1>
<p>Welcome to the temple</p>
mwyCjy2UTTEGZQNDBu8xpdgxf1msEmgxZq
<div id="pray-key" class="container">
    <div><button id="button-get-key">New Key</button></div>
    <input type="text" id="mint-address" />
    <div><button id="button-check-balance">Balance</button></div>
    <p id="mint-key-message"></p>
</div>
<div id="pray-send" class="container" style="display:none">
    <p>Your offering was received.</p>
    <p>Send your wishes to ENKI.</p>
    <textarea id="pray-message"></textarea>
    <div><button id="pray-submit">Submit</button></div>
</div>
<div id="pray-done" class="container" style="display:none">
    <p></p>
    <img src="" width="640" height="640" />
    <p></p>
</div>
<script>
$(function() {
$('#button-get-key').on('click', function (e) {
    $.ajax({ 
        url: '/api/mintkey/', 
        method: 'POST',
        data: JSON.stringify({}),
        contentType: "application/json",
    }).done(function(data, textStatus, jqXHR) {
        $('#mint-address').val(data.mintAddress);
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.log(arguments);
    })
})
$('#button-check-balance').on('click', function (e) {
    let addr = $('#mint-address').val();
    $.ajax({ 
        url: '/api/balance/', 
        method: 'POST',
        data: JSON.stringify({ mintAddress: addr }),
        contentType: "application/json",
    }).done(function(data, textStatus, jqXHR) {
        $('#mint-key-message').text(data.balance.confirmed +', '+data.balance.unconfirmed);
        if (data.balance.confirmed+data.balance.unconfirmed >= 10000) {
            $('#pray-send').show();
        }
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.log(arguments);
    })
})

$('#pray-submit').on('click', function (e) {
    let message = $('#pray-message').val();
    $.ajax({ 
        url: '/api/pray/', 
        method: 'POST',
        data: JSON.stringify({ message }),
        contentType: "application/json",
    }).done(function(data, textStatus, jqXHR) {
        console.log(data);
        showPrayerResponse(data);
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.log(arguments);
    })
});

function showPrayerResponse (data) {
    $('#pray-done img').attr('src','data:image/png;base64,'+data.imageBase64);
    $('#pray-done p').text(data.message);
    $('#pray-done').show();
}

});
</script>
</body>
</html>